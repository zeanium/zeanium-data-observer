!function(c){var i=c.Class({properties:{direction:{value:"oneway",readonly:!0},target:{value:null,readonly:!0},targetPath:{value:"",readonly:!0},source:{get:function(t){return t?this._owner:this._source},set:function(t){this._source=t,this.__rebind()}},sourcePaths:{get:function(){return this._sourcePaths},set:function(t){this._sourcePaths=this.__parseSourcePaths(t,function(t,e){t&&this.__rebind()}.bind(this))}},owner:{get:function(){return this._owner}},converter:{value:null},async:{value:!1}},methods:{init:function(t,e,n){var i=n||{},s=t.member(e);s&&s.meta.binding;c.overwrite(i,{direction:"oneway",converter:{}});var r=this._direction=i.direction;this._source=i.source,this._sourcePaths=this.__parseSourcePaths(i.sourcePaths),this._owner=i.owner||t,this._converter=this.__parseConverter(i),this._target=t,this._targetPath=e,"twoway"!==r&&"oneway"!==r||this.__rebind(),"twoway"!==r&&"inverse"!==r||t.watch(e,function(t){this.__updateSource(t)},this)},dispose:function(){this._source=null,this.__rebind()},__updateSource:function(e){var n=this._converter,i=null;return c.each(this.sourcePaths,function(t){i=n.revert.call(n.context,e),c.path(this.get("source",t[0]),t[1],i)},this),this},__updateTarget:function(){var t,e=this,n=[],i=null,s=this._owner,r=this._target,o=this._targetPath,h=this._converter;return c.each(this.sourcePaths,function(t){i=c.path(e.get("source",t[0]),t[1]),i=c.is(i,"function")?i.bind(s):i,n.push(i)}),t=h.convert.apply(h.context,n),r.set(o,t),this},__rebind:function(){var t=this._sourcePaths,s=this._watchers;return s&&(c.each(s,function(t){t.source.unwatch(t.path,t.handler)}),this._watchers=null),c.each(t,function(t){var e=t[0],n=t[1],i=this.get("source",e);c.can(i,"watch")&&(i.watch(n,this.__updateTarget.bind(this)),(s=s||[]).push({source:i,path:n,handler:this.__updateTarget}))},this),this.__updateTarget()},__parseSourcePaths:function(t,e){for(var n=t.split(","),i="",s=!1,r=0,o=n.length;r<o;r++)"#"===(i=n[r].trim()).charAt(0)&&(i=i.substring(1),s=!0),n[r]=[s,i],e&&e(s,i);return n},__parseConverter:function(t){var e=t.converter;(c.is(e,"string")||c.is(e,"function"))&&(e={convert:e});var n=e.convert=t.convert||e.convert||function(t){return t};if(e.revert=t.revert||function(t){return t},e.context=t.context||this.owner,c.is(n,"string")){var i=n.lastIndexOf("."),s=n,r=this.source||this.owner,o="";0<i&&(o=n.slice(0,i),s=n.slice(i+1),r=c.path(this.source,o)),n=r&&r[s]}return e.convert=n,e}}}),r=c.Class("zn.data.Bindable",c.data.Observable,{statics:{parseOptions:function(t,e){var n=null;if("string"==typeof t&&"{"===t.charAt(0)&&"}"===t.charAt(t.length-1)){var i=t.slice(1,-1).split(";");n={owner:e,sourcePaths:i.shift()},c.each(i,function(t){if(!t)return-1;var e=t.split("=");n[e[0]]=e[1]})}else"object"==typeof t&&(n=t);return n}},properties:{model:{get:function(){return this._model},set:function(e){this._model=e,c.each(this.__bindings__,function(t){t.set("source",e)})}}},methods:{init:{auto:!0,value:function(){this.__bindings__={}},after:function(){this.__binding()}},dispose:function(){this.super(),c.each(this.__bindings__,function(t){t.dispose()}),this.__bindings__=null},let:function(t,e,n,i){var s=r.parseOptions(e);s?(s.owner=n,this.setBinding(t,s,i)):this.set(t,e)},getBinding:function(t){return this.__bindings__[t]},setBinding:function(t,e,n){return e.source=e.model||this.get("model"),e.owner=e.owner||this,this.clearBinding(t),this.__bindings__[t]=new i(n||this,e.targetPath||t,e),this},clearBinding:function(t){var e=this.__bindings__[t];e&&(e.dispose(),delete this.__bindings__[t])},__binding:function(){var n=this,t=this.constructor.getMeta("properties");c.each(t,function(t,e){t&&t.binding&&n.let(e,t.binding)})}}})}(zn);